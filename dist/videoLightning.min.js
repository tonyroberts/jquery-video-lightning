"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}(function(a){var b=this,c=a,d=/*#__PURE__*/function(){function a(b,c){_classCallCheck(this,a),this.buildOpts=this.buildOpts.bind(this),this.buildEls=this.buildEls.bind(this),this.popoverPos=this.popoverPos.bind(this),this.resize=this.resize.bind(this),this.regEvents=this.regEvents.bind(this),this.clicked=this.clicked.bind(this),this.hovered=this.hovered.bind(this),this.peek=this.peek.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.clear=this.clear.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.cover=this.cover.bind(this),this.initPlayerYT=this.initPlayerYT.bind(this),this.setYTPlayer=this.setYTPlayer.bind(this),this.ytPlay=this.ytPlay.bind(this),this.ytStop=this.ytStop.bind(this),this.ytState=this.ytState.bind(this),this.coverYT=this.coverYT.bind(this),this.initPlayerVM=this.initPlayerVM.bind(this),this.vmListen=this.vmListen.bind(this),this.vmPlay=this.vmPlay.bind(this),this.vmStop=this.vmStop.bind(this),this.elObj=b,this.opts=l({},c),this.inst=s(),this.el=this.elObj.el,this.buildOpts(),this.buildEls(),h(this.opts.cover,!1)&&this.cover(),this.regEvents()}return _createClass(a,[{key:"buildOpts",value:function buildOpts(){var b,c,a=Math.round,d=this;l(this.opts,this.elObj.opts);var e=this.el.dataset||[];if(0===e.length)for(var f=0,g=["id","width","height"];f<g.length;f++)b=g[f],c=this.el.getAttribute("data-video-".concat(b)),c&&(e[b]=c);var h=function(a,b){return d.opts[a.replace(/^video(.)(.*)/,function(d,a,b){return a.toLowerCase()+b})]=b};for(b in e)c=e[b],h(b,c);this.opts.width=this.opts.width?parseInt(this.opts.width,10):640,this.opts.height=this.opts.height?parseInt(this.opts.height,10):390;var i=this.opts.height/this.opts.width;return!this.opts.fullscreenAllowed&&this.opts.width>window.innerWidth-90&&(this.opts.width=window.innerWidth-90,this.opts.height=a(i*this.opts.width)),null==this.opts.id&&(this.opts.id="y-dQw4w9WgXcQ"),this.opts.id.match(/^v/)?(this.vendor="vimeo",this.vm=!0):this.opts.id.match(/^f/)?(this.vendor="iframe",this.ifr=!0):(this.vendor="youtube",this.yt=!0),window.vlData[this.vendor]=!0,this.id=this.opts.id.replace(/([vyf]-)/i,""),Array.from([["backdrop_color","bdColor"],["backdrop_opacity","bdOpacity"],["ease_in","fadeIn"],["ease_out","fadeOut"],["glow_color","glowColor"],["start_time","startTime"],["z_index","zIndex"],["rick_roll","rickRoll"],["iv_load_policy","ivLoadPolicy"]]).map(function(a){return null==d.opts[a[1]]?d.opts[a[1]]=d.opts[a[0]]:d.opts[a[1]]})}},{key:"buildEls",value:function buildEls(){var a;(this.target=c.createElement("span")).className="video-target",this.el.parentNode.insertBefore(this.target,this.el),this.target.appendChild(this.el);var b=v(f(this.opts.bdColor,"#ddd")),d=f(this.opts.bdOpacity,.6),e="background: rgba(".concat(b.r,", ").concat(b.g,", ").concat(b.b,", ").concat(d,");"),j="width: ".concat(this.opts.width,"px; height: ").concat(this.opts.height,"px;"),k="margin-top: -".concat(this.opts.height/2,"px; margin-left: -").concat(this.opts.width/2,"px;"),l="box-shadow: 0px 0px ".concat(a=f(this.opts.glow,20),"px ").concat(a/5,"px ").concat(u(f(this.opts.glowColor,"#000")),";"),m=h(this.opts.popover,!1)?w(this.opts.width,this.opts.height):"display: none; position: fixed; min-width: 100%; min-height: 100%; top: 0; right: 0; bottom: 0; left: 0;",n="background: ".concat(u(f(this.opts.xBgColor,"#000")),"; color: ").concat(u(f(this.opts.xColor,"#fff")),"; border: ").concat(f(this.opts.xBorder,"none"),"; box-sizing: border-box;"),o="background: ".concat(u(f(this.opts.frameColor,"#000")),"; border: ").concat(f(this.opts.frameBorder,"none"),"; box-sizing: border-box;");return this.target.insertAdjacentHTML("beforeend",i({tag:"div",attrs:{id:"wrap_".concat(this.inst),class:"video-wrapper",style:"".concat(m," ").concat(e," z-index: ").concat(f(this.opts.zIndex,2100),"; opacity: 0;")},children:[{tag:"div",attrs:{class:"video-frame",style:"".concat("position: absolute; top: 50%; left: 50%; background: #000000;"," ").concat(j," ").concat(k," ").concat(l)},children:[{tag:"div",attrs:{class:"video"},children:[{tag:"div",inner:"&times;",attrs:{id:"close_".concat(this.inst),class:"video-close",style:"float: right; margin-right: -34px; ".concat(l," ").concat(n," padding: 0 10px 0 12px; font-size: 25px;")}},{tag:"iframe",// "#{if @yt then 'div' else 'iframe'}"
attrs:{type:"text/html",id:"iframe_".concat(this.inst),class:"video-iframe",style:"position: absolute; top: 0; left: 0; ".concat(o)}}]}]}]})),this.wrapper=c.getElementById("wrap_".concat(this.inst)),this.iframe=c.getElementById("iframe_".concat(this.inst)),this.close=c.getElementById("close_".concat(this.inst))}},{key:"popoverPos",value:function popoverPos(){var a=F(this.target,this.opts.width,this.opts.height,this.opts.fluidity);return this.wrapper.style.left="".concat(a.x,"px"),this.wrapper.style.top="".concat(a.y,"px")}},{key:"resize",value:function resize(){if(!window.vlData.throttle&&(this.popoverPos(),this.opts.throttle)){window.vlData.throttle=!0;return setTimeout(function throttleOff(){return window.vlData.throttle=!1},this.opts.throttle)}}},{key:"regEvents",value:function regEvents(){if(this.target.style.cursor="pointer",this.target.addEventListener("mouseup",this.clicked,!1),h(this.opts.popover,!1)&&(window.addEventListener("resize",this.resize,!1),window.addEventListener("scroll",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1),this.opts.peek))return this.target.addEventListener("mouseenter",this.hovered,!1),this.target.addEventListener("mouseleave",this.hovered,!1)}},{key:"clicked",value:function clicked(a){return this.peeking?this.peek(!1,!0):a.buttons&&1!==a.buttons||a.which&&1!==a.which||a.button&&1!==a.button?void 0:this.playing?this.stop():this.play()}},{key:"hovered",value:function hovered(a){if("mouseenter"!==a.type||this.playing||this.peek(),"mouseleave"===a.type&&this.playing)return this.peek(this.peeking)}},{key:"peek",value:function peek(a,b){if(null==a&&(a=!1),null==b&&(b=!1),this.peeking||!this.playing)return this.close.innerHTML=a||b?"&times;":"&#94;",this.peeking=!a||b,a?this.stop():b?null:this.play()}},{key:"play",value:function play(){h(this.opts.popover,!1)&&this.popoverPos(),this.show(),this.ifr?j(this.iframe,{url:encodeURI(this.id),attrs:{width:this.opts.width,height:this.opts.height,frameBorder:0}}):this.ready&&!this.playing&&"about:blank"!==this.iframe.src?(this.yt&&this.ytPlay(),this.vm&&this.vmPlay()):!this.playing&&(this.vm&&this.initPlayerVM(),this.yt&&this.initPlayerYT()),this.playing=!0,this.clearAfter&&window.clearTimeout(this.clearAfter)}},{key:"stop",value:function stop(a){null==a&&(a=0),h(this.opts.rickRoll,!1)||(this.hide(a),this.ready?(this.yt&&this.ytStop(),this.vm&&this.vmStop()):this.clear(),this.playing=!1,h(this.opts.unload,!0)&&(this.clearAfter=window.setTimeout(this.clear,1e3*(f(this.opts.unloadAfter)||45))))}},{key:"clear",value:function clear(){this.iframe.src="about:blank"}},{key:"show",value:function show(){y(this.wrapper,f(this.opts.fadeIn,300))}},{key:"hide",value:function hide(a){null==a&&(a=0),z(this.wrapper,f(this.opts.fadeOut,a))}},{key:"cover",value:function cover(){this.yt&&this.coverYT()}},{key:"initPlayerYT",value:function initPlayerYT(){if(this.iframe.setAttribute("allow","fullscreen; autoplay"),j(this.iframe,{url:"https://www.youtube.com/embed/".concat(this.id),params:{enablejsapi:1,autoplay:g(this.opts.autoplay,1),autohide:f(this.opts.autohide,2),cc_load_policy:f(this.opts.ccLoadPolicy,0),color:f(this.opts.color,null),controls:f(this.opts.controls,2),disablekb:f(this.opts.disablekb,0),end:f(this.opts.endTime,null),fs:f(this.opts.fs,1),hl:f(this.opts.hl,"en"),iv_load_policy:f(this.opts.ivLoadPolicy,1),list:f(this.opts.list,null),listType:f(this.opts.listType,null),loop:f(this.opts.loop,0),modestbranding:f(this.opts.modestbranding,0),origin:encodeURIComponent(f(this.opts.origin,"".concat(location.protocol,"//").concat(location.host))),playerapiid:this.inst,playlist:f(this.opts.playlist,null),playsinline:f(this.opts.playsinline,0),rel:f(this.opts.rel,0),showinfo:f(this.opts.showinfo,1),start:f(this.opts.startTime,0),theme:f(this.opts.theme,null)},attrs:{width:this.opts.width,height:this.opts.height,frameBorder:0}}),window.vlData.ytAPIReady)return this.setYTPlayer()}},{key:"setYTPlayer",value:function setYTPlayer(){var a=this;return null==this.ytPlayer?this.ytPlayer=new YT.Player("iframe_".concat(this.inst),{events:{onReady:function ready(){return a.ready=!0},onStateChange:this.ytState}}):this.ytPlayer}},{key:"ytPlay",value:function ytPlay(){return this.ytPlayer.playVideo()}},{key:"ytStop",value:function ytStop(){B(this.ytPlayer,this.opts.startTime),this.ytPlayer.stopVideo(),this.ytPlayer.clearVideo(),this.opts.startTime&&this.clear()}},{key:"ytState",value:function ytState(a){if(0===a.data&&h(this.opts.autoclose,!0))return this.stop(f(this.opts.fadeOut,1e3))}},{key:"coverYT",value:function coverYT(){this.ytCover=D(this.target,"//img.youtube.com/vi/".concat(this.id,"/hqdefault.jpg"))}},{key:"initPlayerVM",value:function initPlayerVM(){return this.iframe.setAttribute("allowFullScreen",""),j(this.iframe,{url:"https://player.vimeo.com/video/".concat(this.id),params:{autoplay:g(this.opts.autoplay,1),loop:f(this.opts.loop,0),title:f(this.opts.showinfo,1),byline:f(this.opts.byline,1),portrait:f(this.opts.portrait,1),color:t(f(this.opts.color,"#00adef")),api:1,player_id:this.inst},attrs:{width:this.opts.width,height:this.opts.height,frameBorder:0}}),window.addEventListener("message",this.vmListen,!1),null==this.vmPlayer?this.vmPlayer=this.iframe:this.vmPlayer}},{key:"vmListen",value:function vmListen(a){var b=JSON.parse(a.data);if(b.player_id===this.inst)switch(b.event){case"ready":this.ready=!0,C(this.vmPlayer,this.id,"addEventListener","finish");break;case"finish":this.stop(1e3);}}},{key:"vmPlay",value:function vmPlay(){C(this.vmPlayer,this.id,"play")}},{key:"vmStop",value:function vmStop(){C(this.vmPlayer,this.id,"pause"),this.opts.startTime&&this.clear()}}]),a}(),f=function(a,b){return[!1,"false",0,"0"].includes(a)?a:a||b},g=function(a,b){return[!1,"false",0,"0"].includes(a)?0:[!0,"true","1",1].includes(a)?1:b},h=function(a,b){return![!1,"false",0,"0"].includes(a)&&(!!a||b)},i=function(a){var b="",d="";if(a.attrs)for(var h in a.attrs){var j=a.attrs[h];b+=" ".concat(h,"=\"").concat(j,"\"")}if(a.children)for(var e,f=0,g=Array.from(a.children);f<g.length;f++)e=g[f],d+=p(e)?i(e):e;return"<".concat(a.tag).concat(b,">").concat(a.inner||d,"</").concat(a.tag,">")},j=function(a,b){var c,d,e="".concat(b.url,"?");for(c in b.params)d=b.params[c],null!==d&&(e+="&".concat(c,"=").concat(d));return a.src=e.replace(/&/,""),function(){var e=[];for(c in b.attrs)d=b.attrs[c],e.push(a[c]=d);return e}()},l=function(a,b){for(var c in b){var d=b[c];a[c]=d}return a},m=function(a){return"string"==typeof a},n=function(a){return a instanceof Array},o=function(a){return a instanceof HTMLCollection||a instanceof NodeList},p=function(a){return null!==a&&"object"===_typeof(a)},q=function(a){for(var b in a){a[b];return b}},r=function(a){var b="#"===a.charAt(0)?c.getElementById(a.substr(1)):c.getElementsByClassName(a.substr(1));return n(b)&&0===b.length?null:b},s=function(){return(Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)).substring(0,16)},t=function(a){return a=a.replace(/^#/,""),3===a.length?"".concat(a).concat(a):a},u=function(a){return"transparent"===a?a:"#".concat(t(a))},v=function(a){return{r:parseInt(t(a).substring(0,2),16),g:parseInt(t(a).substring(2,4),16),b:parseInt(t(a).substring(4,6),16)}},w=function(a,b){return"display: none; position: fixed; width: ".concat(a,"px; height: ").concat(b,"px;")},x=function(a,b){return a.style.transition=a.style.mozTransition=a.style.webkitTransition="opacity ".concat(b,"ms ease")},y=function(a,b){x(a,b),a.style.display="block";return setTimeout(function applyFade(){return a.style.opacity=1},20)},z=function(a,b){x(a,b),a.style.opacity=0;return setTimeout(function applyFade(){return a.style.display="none"},b)},A=function(){if(!c.getElementById("ytScript")){var b=c.getElementsByTagName("script")[0],d=a.createElement("script");d.innerHTML="function onYouTubeIframeAPIReady() {vlData.ytReady()};",b.parentNode.insertBefore(d,b);var e=a.createElement("script");e.id="ytScript",e.async=!0,e.src="https://www.youtube.com/iframe_api",d.parentNode.insertBefore(e,d.nextSibling)}},B=function(a,b){null==b&&(b=0),a.getDuration()-3<a.getCurrentTime()&&(a.pauseVideo(),a.seekTo(b,!1))},C=function(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,e=d?{method:c,value:d}:{method:c};return a.contentWindow.postMessage(JSON.stringify(e),"https://player.vimeo.com/video/".concat(b))},D=function(a,b){var d=c.createElement("img");return d.className="video-cover",d.src=b,a.appendChild(d),d},E=function(){var b;return(b=a.getElementById("vl-size-test"))||(b=a.createElement("div"),b.id="vl-size-test",b.style.cssText="position:fixed;top:0;left:0;bottom:0;right:0;visibility:hidden;",a.body.appendChild(b)),{width:b.offsetWidth,height:b.offsetHeight}},F=function(a,b,c,d){var e,f,g,h,k,l,m,n,o,p,q,r;null==d&&(d=30);var s=a.getBoundingClientRect(),t={x:(f=E().width)/2,y:(e=E().height)/2},u={x:b/2,y:c/2},v=[];for(m=s.left,g=m,l=s.right+b,n=d,k=0<n;k?m<=l:m>=l;m+=n,g=m)v.push([g-b,s.top-c]),v.push([g-b,s.bottom]);for(q=s.top,h=q,p=s.bottom+c,r=d,o=0<r;o?q<=p:q>=p;q+=r,h=q)v.push([s.left-b,h-c]),v.push([s.right,h-c]);var w=function(d,a){for(var i,j,k=0,l=[[d,i={}],[a,j={}]];k<l.length;k++){var m,n,o=l[k];g=o[0][0],h=o[0][1],o[1].diffx=(m=g+u.x)>t.x?m-t.x:t.x-m,o[1].diffy=(n=h+u.y)>t.y?n-t.y:t.y-n,o[1].diff=o[1].diffx+o[1].diffy,(0>g||g+b>f)&&(o[1].diff+=1e4),(0>h||h+c>e)&&(o[1].diff+=1e4)}return i.diff-j.diff};return v.sort(w),{x:parseInt(0>(g=v[0][0])||g+b>f?t.x-u.x:g,10),y:parseInt(0>(h=v[0][1])||h+c>e?t.y-u.y:h,10)}};this.videoLightning=function videoLightning(a){var c,f=function(){console.error("VideoLightning was initialized without elements.")},g=a.elements||a.element;if(!g)return f();var h=[],i=[],j=function(a){if(m(a))return h.push({el:a,opts:null});var b=q(a);return h.push({el:b,opts:a[b]||null})};if(n(g))for(var k,l=0,p=Array.from(g);l<p.length;l++)k=p[l],j(k);else j(g);for(var s=0,t=Array.from(h);s<t.length;s++){c=t[s];var u;if(u=r(c.el))if(o(u))for(var v,w=0,x=Array.from(u);w<x.length;w++)v=x[w],i.push({el:v,opts:c.opts});else i.push({el:u,opts:c.opts})}if(0===i.length)return f();for(var y=a.settings||{},z=0,B=Array.from(i);z<B.length;z++)c=B[z],c&&b.vlData.instances.push(new d(c,y));A()},this.vlData={},this.vlData.instances=[],this.vlData.ytReady=function(){return b.vlData.ytAPIReady=!0},this.vlData.youtube=this.vlData.vimeo=!1;var G=window.$||a.$;if("undefined"!=typeof G)return G.fn.jqueryVideoLightning=function(a){return this.each(function(){if(!G.data(this,"plugin_jqueryVideoLightning")){var b=new d({el:this,opts:a});vlData.instances.push(b),G.data(this,"plugin_jqueryVideoLightning",b)}}),A()},G.fn.jqueryVideoLightnin})(document);
